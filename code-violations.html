<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>Denton Data Day - 2016</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; }
      #map { height: 100%; }
      #code-violations-widget { height: 500px; }
    </style>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
  </head>
  <body>
    <section id="container" >
        <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
        <!--header start-->
        <header class="header black-bg">
                <div class="sidebar-toggle-box">
                    <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
                </div>
              <!--logo start-->
              <a href="index.html" class="logo"><b>Denton Data Day - 2016</b></a>
              <!--logo end-->
              <div class="nav notify-row" id="top_menu">
                  <!--  notification start -->
                  <ul class="nav top-menu">
                      <!-- settings start -->
                      <!-- inbox dropdown end -->
                  </ul>
                  <!--  notification end -->
              </div>

          </header>
        <!--header end-->

        <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
        <!--sidebar start-->
        <aside>
            <div id="sidebar"  class="nav-collapse ">
                <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered"><a href="index.html"><img src="assets/img/dd2016.png" width="60"></a></p>
              	  <h5 class="centered">Denton Data Day</h5>
              	  	
                  <li class="mt">
                      <a href="index.html">
                          <i class="fa fa-dashboard"></i>
                          <span>Dashboard</span>
                      </a>
                  </li>

                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Public Safety</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="codeviolation.html">Code Violations 2002-2016</a></li>
                          <li><a  href="code-violations.html">Code Violations Interactive Map</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>

                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Voting</span>
                      </a>
                      <ul class="sub">
                          <li><a  href=".html">Turnout</a></li>
                          <li><a  href=".html">-</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Population Income</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="blank.html">Low-income</a></li>
                          <li><a  href=".html">-</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Food Security</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="blank.html">another category</a></li>
                          <li><a  href=".html">-</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a  href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Housing Cost</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="blank.html">Maps?</a></li>
                          <li><a  href=".html">-</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>
                  <li class="sub-menu">
                      <a href="javascript:;" >
                          <i class="fa fa-book"></i>
                          <span>Vehicles</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="blank.html">Miles Traveled</a></li>
                          <li><a  href=".html">-</a></li>
                          <li><a  href=".html">-</a></li>
                      </ul>
                  </li>

              </ul>
              <!-- sidebar menu end-->
            </div>
        </aside>
        <!--sidebar end-->

        <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
        <!--main content start-->
        <section id="main-content">
            <section class="wrapper site-min-height">
            	<h3><i class="fa fa-angle-right"></i>Code Violations Interactive Map</h3>
            	<div class="row mt">
            		<div class="col-lg-12">
            		<p>Use the map below to view the number of violations by location. Click the red circles for more information.</p>

                <div id="code-violations-widget">
                  <form class="col-md-6 col-md-offset-2">
                    <select id="yearOptions" class="form-control" type="year">
                      <option value="2005">2005</option>
                      <option value="2006">2006</option>
                      <option value="2007">2007</option>
                      <option value="2008">2008</option>
                      <option value="2009">2009</option>
                      <option value="2010">2010</option>
                      <option value="2011">2011</option>
                      <option value="2012">2012</option>
                      <option value="2013">2013</option>
                      <option value="2014">2014</option>
                      <option value="2015">2015</option>
                      <option value="2016">2016</option>
                    </select>
                    <button id="yearChanger" class="btn btn-primary">Change</button>
                  </form>

                  <div id="map" class="col-md-12"></div>
                </div>

            		</div>
            	</div>

  		</section><! --/wrapper -->
        </section><!-- /MAIN CONTENT -->

        <!--main content end-->
        <!--footer start-->
        <footer class="site-footer">
            <div class="text-center">
                2014 - Alvarez.is
                <a href="blank.html#" class="go-top">
                    <i class="fa fa-angle-up"></i>
                </a>
            </div>
        </footer>
        <!--footer end-->
    </section>



    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <script>
      window.addEventListener("load", loadCodeViolationMap, false);

      function loadCodeViolationMap() {
        var yearOptions = document.querySelector("#yearOptions");
        var yearChanger = document.querySelector("#yearChanger");
        yearChanger.addEventListener("click", function(e) {
          e.preventDefault();
          currentYear = yearOptions.value;
          var widget = document.querySelector("#code-violations-widget");
          widget.removeChild(document.querySelector("#map"));
          var map = document.createElement("div");
          map.setAttribute("id", "map");
          map.setAttribute("class", "col-md-12");
          widget.appendChild(map);
          graphData(allData, currentYear)
        }, false);


        var allData;
        $.getJSON('/assets/data/code-violations.json', function(data) {
            allData = data;
            graphData(data, 2005)
        });
      }

      function graphData(data, currentYear) {
        var coords = [33.1991652, -97.1239831];
        var map = L.map('map').setView(coords, 13);

        var data = data[currentYear];

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
          maxZoom: 18,
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
             '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
             'Imagery © <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(map);

        for (index in data) {
          L.circle([data[index].lon, data[index].lat], 100, {
            title: data[index].heatIndex,
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5
          }).addTo(map)
          .bindPopup("There was " + data[index].heatIndex + " code violations here. " + data[index].STARTED)
          .openPopup();
        }
      }
   </script>
  </body>
</html>
